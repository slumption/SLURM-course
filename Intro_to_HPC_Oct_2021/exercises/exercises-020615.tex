% $Header: /Users/joseph/Documents/LaTeX/beamer/solutions/generic-talks/generic-ornate-15min-45min.en.tex,v 90e850259b8b 2007/01/28 20:48:30 tantau $

\documentclass{beamer}

% Based on solutions/generic-ornate-15min-45min.en.tex
% and HPCS-UoC-Beamer-master/uoc-beamer-template-1.tex.

% Copyright 2004 by Till Tantau <tantau@users.sourceforge.net>.
%
% In principle, this file can be redistributed and/or modified under
% the terms of the GNU Public License, version 2.
%
% However, this file is supposed to be a template to be modified
% for your own needs. For this reason, if you use this file as a
% template and not specifically distribute it as part of a another
% package/program, I grant the extra permission to freely copy and
% modify this file as you see fit and even to delete this copyright
% notice. 


\mode<presentation>
{
  \usetheme{cambridge}
  %\usetheme{Warsaw}

  \setbeamertemplate{navigation symbols}{}
  \setbeamercovered{transparent}
  % or whatever (possibly just delete it)
}

\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage{multicol}

%\usepackage{times}
%\usepackage[T1]{fontenc}
% Or whatever. Note that the encoding and the font should match. If T1
% does not look nice, try deleting the line with the fontenc.


\title[HPC: An introduction --- Exercises] % (optional, use only with long paper titles)
{An Introduction to High Performance Computing and the HPCS --- Exercises}

%\subtitle
%{Presentation Subtitle} % (optional)

\author[SJ Rankin] % (optional, use only with lots of authors)
{Stuart Rankin\\ \texttt{sjr20@cam.ac.uk}}
%{F.~Author\inst{1} \and S.~Another\inst{2}}
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[HPCS, University of Cambridge] % (optional, but mostly needed)
{High Performance Computing Service (http://www.hpc.cam.ac.uk/)\\
University Information Services (http://www.uis.cam.ac.uk/)}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

\date[20/11/2014] % (optional)
{20th November 2014 / UIS Training}

\subject{Courses --- Exercises}
% This is only inserted into the PDF information catalog. Can be left
% out. 



% If you have a file called "university-logo-filename.xxx", where xxx
% is a graphic format that can be processed by latex or pdflatex,
% resp., then you can add a logo as follows:

% \pgfdeclareimage[height=0.5cm]{university-logo}{university-logo-filename}
% \logo{\pgfuseimage{university-logo}}



% Delete this, if you do not want the table of contents to pop up at
% the beginning of each subsection:
%\AtBeginSubsection[]
%{
%  \begin{frame}<beamer>{Outline}
%    \tableofcontents[currentsection,currentsubsection]
%  \end{frame}
%}


% If you wish to uncover everything in a step-wise fashion, uncomment
% the following command: 

%\beamerdefaultoverlayspecification{<+->}


\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\section{Login}
\begin{frame}{Exercise 1: Login}
\begin{itemize}
\item{Using MobaXterm, login to your HPCS training account.}
\begin{description}
\item[\emph{Hints:}]{\small Start MobaXterm by double clicking on the file \alert{MobaXterm\_Personal\_7.3.exe} in the folder U:$\backslash\backslash$MobaXterm. Press \alert{Session} (top left) and \alert{SSH} in the settings panel which appears.\\\smallskip
The remote host is \alert{login.hpc.cam.ac.uk}. Specify the username --- this is the same name as your MCS Desktop training account (i.e. \alert{z4XY}).\hfill\\\smallskip
{\scriptsize N.B.\ If in doubt about the name of your training account, check the number of your station (see the label on the top of the box), then station 1\textbf{XY} should correspond to account z4\textbf {XY}.}\hfill\\\smallskip
Under \alert{Advanced SSH settings} tick \alert{Use private key} and select the keyfile \alert{id\_rsa} in the MobaXterm folder. Click OK. The passphrase when prompted is \alert{\emph{``Introduction to HPC''}}.}
\end{description}
\end{itemize}
\end{frame}

\section{File transfer}
\begin{frame}{Exercise 2: File transfer}
\begin{itemize}
\item{Using MobaXterm, SFTP the file \alert{exercises.tgz} to your HPCS training account.}
\visible<2->{\begin{description}
\item[\emph{Hints:}]{\small Start a SFTP session, using the same remote host, username, private key and passphrase as in the previous exercise.\\\smallskip
Drag the \alert{exercises.tgz} file from the \alert{U drive} to your home directory on the HPCS (this is the initial directory viewed after the connection is made).}
\end{description}}
\item{Switch back to the SSH session you created in the previous exercise. Verify that the file is now present by using \alert{ls}.}
\visible<3->{\begin{description}
\item[\emph{Hints:}]{Do \alert{ls -al exercise*}}
\end{description}}
\item{Unpack the tar archive to create an exercise subdirectory.}
\visible<4->{\begin{description}
\item[\emph{Hints:}]{Do \alert{tar -zxvf exercises.tgz}}
\end{description}}
\end{itemize}
\end{frame}

\section{Remote desktop}
\begin{frame}{Exercise 3: Remote desktop [Optional]}
\begin{itemize}
\item{Using MobaXterm, connect to the remote desktop running on \alert{login-gfx1.hpc.cam.ac.uk} on display \alert{99}. The VNC password is \alert{\emph{``trAin99''}}.}
\visible<2->{\begin{description}
\item[\emph{Hints:}]{\small Start a VNC session. Because the HPCS only allows SSH connections, to use VNC we need to tunnel via SSH.\hfill\\\smallskip
Use \alert{localhost} as the remote hostname, and set the Port to \alert{$5900+99=5999$}.\hfill\\\smallskip
Now go to \alert{Advanced VNC settings}, tick \alert{Connect through SSH gateway} and enter \alert{login-gfx1.hpc.cam.ac.uk} as the gateway server, with your training account ID as the user. As before, select the private key from the MobaXterm folder. Click OK.\hfill\\\smallskip
You should be prompted first for the key passphrase (\alert{\emph{``Introduction to HPC''}}), then for the VNC password which is \alert{\emph{``trAin99''}}. Note that this is a view-only password.}
\end{description}}
\end{itemize}
\end{frame}

\section{Modules and Compilers}
\begin{frame}{Exercise 4: Modules and Compilers}
\begin{itemize}
\item{Go to the \alert{exercises} directory of your HPCS training account.}
\visible<2->{\begin{description}
\item[\emph{Hints:}]{\small Firstly you may need to review Exercise~1 in order to reconnect to your HPCS training account. (Note that your earlier SSH session may in fact be saved on the left side.) At the HPCS command prompt, change to the exercises directory (\alert{cd $\tilde{}$/exercises}).}
\end{description}}
\item{Try to compile the \alert{hello.c} program using the default \alert{icc} compiler (it will fail because there is a deliberate bug).}
\visible<3->{\begin{description}
\item[\emph{Hints:}]{\small \alert{icc hello.c -o hello}}
\end{description}}
\item{To fix the problem, open the \alert{hello.c} file in the \alert{gedit} editor.}
\visible<4->{\begin{description}
\item[\emph{Hints:}]{\small Launch gedit in the background by doing \alert{gedit\&}. A gedit window should appear. Remove the word \alert{BUG} and save the file.}
\end{description}}
\end{itemize}
\end{frame}

\begin{frame}{Exercise 4: Modules and Compilers (ctd)}
\begin{itemize}
\item{Try again to compile the \alert{hello.c} program using the default \alert{icc} compiler, and run it. You should see \alert{``\emph{node} says: Hello, World!''}.}
\visible<2->{\begin{description}
\item[\emph{Hints:}]{\small \alert{icc hello.c -o hello} then run: \alert{./hello}.}
\end{description}}
\item{Which version of \alert{icc} did you use? Find this out by listing the current modules loaded.}
\visible<3->{\begin{description}
\item[\emph{Hints:}]{\small \alert{module list} --- the Intel compiler modules are named \alert{intel/cce/\emph{version}}.  You can also work out the version directly by finding the location of the binary, e.g.\ doing\hfill\\
\alert{which icc} which should return the path:\hfill\\
\alert{/usr/local/Cluster-Apps/intel/cce/\emph{version}/bin/icc}.}
\end{description}}

\item{Compile and run the \alert{hello.c} program in the exercises directory using a non-default C compiler.}
\visible<4->{\begin{description}
\item[\emph{Hints:}]{\small E.g. load the latest PGI C compiler (\alert{pgcc}) with \alert{module load pgi}. module av will show all possible choices (not all of which are compilers).}
\end{description}}
\end{itemize}
\end{frame}

\section{Submitting Jobs}
\begin{frame}{Exercise 5: Submitting Jobs}
\begin{itemize}
\item{Submit a job which will run a copy of your hello program on all cores of the 4 12-core nodes which are available for training.}
\visible<2->{\begin{description}
\item[\emph{Hints:}]{\scriptsize\begin{enumerate}
\item{Edit the script \alert{job\_script} in your exercises directory. Set:\hfill\\
\alert{\#SBATCH --nodes=4}\hfill\\
\alert{\#SBATCH --ntasks=48}\hfill\\
\alert{application="./hello"}\hfill\\
In the module section, make sure that the module you used to compile \alert{hello} is also loaded (last).}
\item{Submit the job with \alert{sbatch job\_script}. The jobid is then printed.}
\item{Watch the job in the queue with \alert{squeue}.}
\item{After it has disappeared, open the output file \alert{slurm-jobid.out} in your editor. There should be 12 ``Hello, World!'' messages from 4 different nodes.}
\end{enumerate}%
}
\end{description}}
\end{itemize}
\end{frame}

\begin{frame}{Exercise 6: Submitting Jobs (ctd) [Optional]}
\begin{itemize}
\item{Experiment with changing the number of nodes and tasks by changing and submitting job\_script (you are limited to 4 nodes in total).}
\end{itemize}
\end{frame}

\end{document}
